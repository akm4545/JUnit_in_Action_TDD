# **컨테이너를 활용한 테스트**  
  
# **일반적인 단위 테스트의 한계**  
HttpServlet의 isAuthenticated 메서드를 구현하는 예제  
servlet 패키지 -> SampleServlet 클래스 참조  
  
서블릿이란 웹 애플리케이션 서버에서 동작하는 자바 클래스를 말한다. 사용자 정보가 올바른지를 확인할 수 있는 인증 메커니즘이 필요한데 사용자  
인증이 되었는지를 검증하는 메서드로 isAutehnticated 메서드를 사용하며 테스트하는 상황이라고 가정한다.  
  
해당 서블릿 예제는 일반적인 단위 테스트의 문제가 무엇인지 보여 준다. 만약 isAuthenticated 메서드를 테스트하려면 사전에 유효한  
HttpServletRequest 객체를 가지고 있어야 한다. 그런데 HttpServletRequest는 인터페이스이므로 new 예약어를 사용해서 HttpServletRequest를  
생성할 수가 없다. 게다가 HttpServletRequest 객체의 생애 주기나 구현은 컨테이너(이 경우 서블릿 컨테이너)에서 제공하는 것이지 개발자가 하는  
것이 아니다. HttpSession도 역시 마찬가지다. 즉 JUnit만으로는 isAuthenticated 메서드와 일반적인 서블릿에 관한 테스트를 작성하기가  
어렵다.  
  
서블릿이나 JSP에서 컨테니어는 Tomcat이나 Jetty 같은 서블릿 컨테이너를 말한다. 그 외에는 EJB(Enterprise Java Beans) 컨테이너인 JBoss등이  
있다.(JBoss는 WildFly로 이름이 변경되었다.) 이러한 컨테이너에서 자바 코드는 기본적으로 잘 동작한다. 그러나 컨테이너가 런타임에  
HttpServletRequest 같은 객체를 생성하고 관리하는 한 일반적인 JUnit만으로는(JUnit5 기능을 쓴다든지, 스텁이나 모의 객체를 활용한다든지) 해당  
객체를 테스트하기 어렵다.  
  
# **컴포넌트와 컨테이너**  
컴포넌트는 애플리케이션 또는 애플리케이션의 일부를 말한다. 컨테이너는 컴포넌트가 실행되고 있는 격리된 공간을 말한다. 컨테이너는 생애 주기, 보안  
트랜잭션 등 컴포넌트를 위한 서비스를 제공한다.  
  
# **모의 객체를 활용한 테스트**  
isAuthenticated 메서드를 단위 테스트하기 위해 고려할 만한 첫 번째 방법은 모의 객체 개념을 사용하려 HttpServletRequest 객체를 모의  
하는 것이다. 그러나 모의 객체를 사용하더라도 테스트를 실행하려면 여전히 많은 코드를 작성해야 한다. 다만 EasyMock을 사용하여 모의 객체를 조금  
쉽게 만들 수는 있다.  
  
EasyMock을 활용하여 서블릿 테스트하기  
servlet 패키지 -> TestSampleServletWithEasyMock 클래스 참조  
  
JMock을 활용하여 서블릿 테스트하기  
servlet 패키지 -> TestSampleServletWithJMock 클래스 참조  
  
Mockito를 활용하여 서블릿 테스트하기  
servlet 패키지 -> TestSampleServletWithMockito 클래스 참조  

이렇게 최소한의 컨테이너를 모의 하는 것은 컴포넌트를 테스트하는 데 효과가 있다. 그러나 컨테이너를 모의하기 위해서는 복잡한 코드를 짜야 할 수도  
있다. 다른 테스트와 마찬가지로 만약 서블릿이 변경된다면, 기대도 그에 맞게 변경되어야 한다.  
  
# **컨테이너 활용하기**  
SampleServlet 클래스를 테스트하기 위해 HttpServletRequest와 HttpSession 객체를 갖고 있는 컨테이너를 직접 사용한다. 이렇게 하면 굳이  
모의 객체를 사용할 필요 없이 실제 컨테이너에서 필요한 객체와 메서드에 직접 접근할 수 있다.  
  
현재 예제에서는 웹 요청과 세션이 각각 컨테이너에서 관리하는 실제 HttpServletRequest와 HttpSession 객체가 되어야 한다. 이렇게 컨테이너에서  
테스트를 배포하고 실행하는 메커니즘을 컨테이너를 활용한 테스트(in-container testing)라고 한다.  
  
# **컨테이너를 활용한 테스트 구현 전략**  
컨테이너를 활용한 테스트를 구현하는 방법은 서버 측과 클라이언트 측 두 가지 접근 방식으로 나뉜다. 첫 번째로 서버 측에서 컨테이너와 단위 테스트를  
제어해서 테스할 수 있다. 클라이언트 측에서 테스트를 실행할 수도 있다.  
  
컨테이너를 활용한 테스트의 일반적인 생애 주기  
1. 클라이언트에서 테스트 클래스 실행  
2. 서버 측에서 동일한 테스트 케이스 호출  
3. 도메인 객체 테스트  
4. 결과를 클라이언트에 반환  
  
테스트가 패키징되어 컨테이너와 클라이언트에 배포되면 JUnit runner가 클라이언트에서 테스트를 실행한다. 그러면 클라이언트는 HTTP(S)와 같은  
프로토콜을 통해 연결을 맺고 서버 측으로 동일한 테스트를 호출한다. 서버 측의 테스트는 HttpServletRequest, HttpServletResponse 같이  
일반적으로 많이 사용하는 객체로 도메인 객체를 테스트한다. 테스트 결과는 서버 측에서 클라이언트 측으로 반환하는데 IDE나 Maven이 수집할  
수 있다.
  

