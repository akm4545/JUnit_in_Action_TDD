# **테스트 커버리지 측정하기**  
단위 테스트를 작성하면 애플리케이션을 변경하고 리팩토링할 때 확신을 가질 수 있다. 소스 코드를 바꾼 뒤  
테스트를 돌려 보면 추가한 기능과 변경 내역이 기존 테스트를 통과하는지 못하는지 바로 알 수 있다. 문제는  
코드를 변경함으로써 기존 테스트로 커버하지 못했던 기능이 동작하지 않을 수 있다는 것이다.  
이 문제를 해결하기 위해서는 사용자나 개발자가 테스트를 수행할 때 정확히 어떤 코드가 실행되고 어떤 코드가  
실행이 되지 않는지 알아야 한다. 이상적으로는 테스트가 애플리케이션 코드의 100%를 커버하는 게 좋다.  
테스트 커버리지는 그 자체로 코드의 품질을 어느 정도 보증한다. 하지만 이는 여전히 논란의 여지가 있는 지표다.  
높은 테스트 커버리지가 테스트의 질을 보장하지 않기 떄문이다. 훌륭한 개발자는 테스트를 실행하여 얻어 낸  
기계적인 백분율수치 이상을 볼 수 있어야 한다.  
  
# **테스트 커버리지란 무엇인가**  
블랙박스 테스트 시 테스트 커버리지를 계산하는 데 다양한 지표를 사용할 수 있다. 가장 기본적인 지표는 테스트 묶음을 실행하는  
동안 호출되는 애플리케이션의 메서드나 코드 줄의 수를 가지고 나타낸 백분율이다. 또 다른 지표로 테스트가  
호출하는 메서드를 추적해서 집계할 수 있다. 이 결과는 테스트가 성공했는지를 알려 주지 않는다. 하지만 메서드에  
대한 테스트가 있는지 없는지를 알려 줄 수는 있다.  
  
화이트박스 테스트 시 메서드가 어떻게 구현되어 있는지 자세히 알고 있다면 단위 테스트를 작성할 수 있다.  
테스트 대상 메서드에 분기문이 있을 경우 각 분기마다 하나씩 단위 테스트를 작성해야 한다.  
  
일반적으로 화이트박스 테스트(단위 테스트)를 활용하면 더 높은 테스트 커버리지를 얻을 수 있다. 더 많은 메서드에  
접근할 수 있을뿐더러 각 메서드에 대한 입력과 보조 객체의 동작을 제어할 수 있기 떄문이다.  
화이트박스 테스트는 protected 메서드, package-private 메서드, public 메서드에도 실행할 수 있으므로 블랙박스  
테스트보다 일반적으로 코드 커버리지가 더 높게 나온다.  
  
블랙박스 테스트로 높은 코드 커버리지를 달성하지 못했다면 보통은 더 많은 테스트가 필요하다는 뜻이다(애플리케이션에  
아직 테스트하지 않은 부분이 있을 것이다). 혹은 비즈니스 목표에 기여하지 않는 불필요한 로직이 있을 수 있다.  
두 경우 모두 실제 원인을 찾기 위해 추가적인 분석이 필요하다.  
  
테스트 커버리지가 높은 프로그램에서는 테스트를 실행할 때 보통 더 많은 코드가 실행된다. 테스트 커버리지가 낮은 프로그램  
보다 발견되지 않은 버그가 더 적을 수 있다.  
  
# **코드 커버리지를 측정하는 도구**  
코드 커버리지 도구는 JUnit과 통합이 잘되어 있다. 실제로 IntelliJ IDEA를 활용하면 코드 커버리지를 편리하게 집계할 수 있다.  
테스트 클래스 오른쪽 클릭 후 [Run ** with Coverage]를 클릭해 테스트 커버리지를 측정할 수 있다.  
테스트 리포트 창에서 [Generate Coverage Report]를 클릭하면 HTML 형식의 리포트도 생성할 수 있다.    
HTML 리포트는 패키지 수준일 수도 있고 클래스 수준일 수도 있으며 개별 코드 줄 수준일 수도 있다.  
명령 프롬프트에서 코드 커버리지 테스트를 실행하는 것을 권장하는데 이는 지속적 통합(continuous integration, CI)이나  
지속적 전달(continuous delivery, CD)을 이루는 일이기도 하다. 이를 위해서는 JaCoCo(Java Code Coverage) 플러그인을 사용하는  
것이 좋다. JaCoCo는 자주 업데이트되고 Maven과 통합이 매우 잘되어 있는 오픈 소스 도구다.  
  
JaCoCo 플러그인 추가  
pom.xml 참고  
  
명령 프롬프트에서 mvn test 명령을 실행하면 테스트 클래스에 대해 코드 커버리지 리포트를 생성한다.  
리포트는 프로젝트 폴더 내 target/site/jacoco 경로에서 확인할 수 있다.

# **테스트하기 쉬운 코드 작성하기**  
테스트 코드 작성은 쉬울 때도 있고 어려울 때도 있는데 애플리케이션이 얼마나 복잡한지에 따라 다르다.  
가장 좋은 사례는 가독성이 좋고 테스트하기 편하도록 가능한 한 소스 코드를 단순하게 작성하는 것이다.  
테스트하기 쉽도록 기존 코드를 리팩토링하는 것보다 테스트하기 쉬운 코드를 작성하는 것이 더 쉽다.  
  
