# **스텁을 활용한 거친 테스트**  
특정한 런타임 환경에 의존하는 애플리케이션을 위한 단위 테스트를 작성하기는 매우 어렵다. 테스트는 안정적이어야 하며 반복적으로  
수행해도 같은 결과가 나와야 하기 떄문이다. 즉 테스트가 실행되는 환경을 제어할 필요가 있는데 이를 위한 방법으로는 실제로 필요한  
환경을 테스트의 일부로 구성하여 테스트를 수행하는 것이다. 때로는 이런 방식이 효과적일 수 있다. 개발 주기로 보자면 개발 단계나  
빌드 단계에서 실제 환경을 제공하는 것도 물론 도음이 된다. 그러나 이는 항상 가능한 방법은 아니다.  
  
예를 들어 개발 중인 애플리케이션이 타사에서 제공하는 웹 서버에 HTTP 통신을 해야 하는 경우 개발 환경에서는 그런 서버 통신을  
하는 것이 사실상 불가능하다. 이때 타사의 웹 서버를 모사하거나 가짜를 만들어 메꿀 수 있다. 가짜 객체를 황용하는 방법은 크게  
두 가지다. 하나는 스텁을 활용하는 것이고 다른 하나는 모의 객체를 활용하는 것이다.  
  
스텁을 사용한다면 스텁이 사전에 정의된 동작만을 수행한다는 점을 유의해야 한다. 스텁 코드는 테스트 외부에 만들어져 있으며  
사용하는 위치나 횟수와 관계없이 동일한 동작을 수행하는데 일반적으로 하드코딩한 값을 반환한다. 스텁으로 테스트할 때는  
스텁 초기화 -> 테스트 실행 -> 단언문 검증 순서로 진행한다.  
  
모의 객체는 사전에 정의된 동작을 수행하지는 않는다. 대신 테스트 실행 중에 모의 객체가 수행할 행동을 기대할 수 있다. 다른  
테스트를 실행하고 모의 객체를 다시 초기화한 뒤 새로운 행동을 기대하는 것도 가능하다. 모의 객체로 테스트할 때는   
모의 객체 초기화 -> 기대 설정 -> 테스트 실행 -> 단언문 검증 순서로 진행한다.  
  
# **스텁 살펴보기**  
스텁은 실제 코드 혹은 아직 구현되지 않은 코드의 동작을 가장하기 위한 장치이다. 시스템의 일부를 사용할 수 없는  
상황에서 테스트하기 위해 스텁을 할용한다. 일반적으로 스텁은 테스트 대상 코드를 변경하지는 않는다. 대신 애플리케이션에서  
빠진 부분을 빈틈없이 채워주는 역할을 한다.  
  
스텁은 호출자를 실제 구현 코드에서부터 격리하기 위해 실제 코드 대신 런타임에 동작하는 코드를 말한다. 단순하게  
만든 스텁으로 실제 코드의 복잡한 기능을 대체하면 애플리케이션에 독립적으로 테스트를 수행할 수 있다.  
  
스텁을 활용하기 좋은 경우는 다음과 같다.  
- 기존 시스템이 너무 복잡하고 깨지기 쉬워 수정이 어려울 때  
- 소스 코드가 통제할 수 없는 외부 환경에 의존하고 있을 때  
- 파일 시스템, 서버, 데이터베이스 같은 외부 시스템을 완전히 교체해야 할 때  
- 하위 시스템 간 통합 테스트 같은 거친(coarse-grained) 테스트를 수행해야 할 때
  
스텁을 활용하기 어려운 경우는 다음과 같다.  
- 실패의 원인을 밝힐 수 있는 정확한 에러 메세지를 확인하기 위해 세밀한(fine-grained)테스트가 필요할 때  
- 코드 전체가 아니라 일부분만 격리해 테스트를 수행해야 할 때  
  
이런 상황에서는 스텁보다 모의 객체를 사용하는 것이 좋다.  
  
일반적으로 스텁은 테스트가 많이 되어 있는 시스템에서 신뢰도가 높은 편이다. 스텁을 활용하면 테스트 대상 객체를  
수정하지 않으면서도 실제 운영에서 실행되는 것과 동일한 소스를 테스트할 수 있다는 장점이 있다. 실제 실행 중인  
환경에서 자동화된 빌드를 통해서 혹은 개발자가 수동으로 테스트를 수행했을 때 스텁을 활용해 테스트를 실행하면  
개발에 확신을 얻을 수 있다.  
  
스텁의 단점은 작성하기가 까다롭다는 것이다. 가장해야 하는 시스템이 복잡할 때는 더욱 그러하다. 스텁은 모사해야 하는  
코드를 간단하고 단순한 방식으로 구현해야 하므로 비즈니스 로직이 복잡하다면 스텁이 적합하지 않다.  
  
스텁을 활용했을 때의 단점은 다음과 같다.  
- 스텁은 작성하기가 까다로워서 스텁 자체를 디버깅해야 하는 일이 종종 생긴다.  
- 스텁이 복잡해져서 유지 보수하기가 어려울 수 있다.  
- 스텁은 세밀한 단위 테스트에는 적합하지 않을 수 있다.  
- 테스트에 따라 다른 스텁을 만들어야 할 수도 있다.  
일반적으로 스텁은 거친 테스트를 수행하는 데 모의 객체보다 선호된다.  
  
coarse-grained는 일반적으로 결이 거친, 성긴 이라는 의미를 가진다. 특히 소프트웨어 개발에서는 비교적 큰 단위의  
대상을 표현할 때 쓰이는데 여기서는 시스템이나 애플리케이션의 개별적인 단위보다는 여러 컴포넌트 혹은 시스템의  
상당 부분을 의미한다.  
