# **데이터베이스 애플리케이션 테스트**  
영속성 계층(대략적으로 말해서 데이터베이스 접근 계층)은 크게 세 가지 이유로 단위 테스트를 수행하기가 까다롭다.  
- 단위 테스트는 코드를 격리시켜 실행해야 한다. 그런데 영속성 계층은 거의 반드시 외부 시스템, 즉 데이터베이스와의 상호작용이 필요하다.  
- 단위 테스트는 작성과 실행이 쉬워야 한다. 그러나 데이터베이스에 접근하는 코드는 작성하기도, 실행하기도 번거로울 수 있다.  
- 단위 테스트는 실행 속도가 빨라야 한다. 반면 데이터베이스에 접근하는 코드들은 상대적으로 느리다.  
  
이런 문제를 데이터베이스 단위 테스트 시 발생하는 임피던스 불일치(database unit testing impedance mismatch)고 부른다. 이는 객체 지향  
프로그래밍과 관계형 데이터베이스 간 임피던스 불일치와 관련된다(해당 용어는 객체 지향 프로그래밍에서 관계형 데이터에비스에 데이터를 영속시키는 것이  
얼마나 어려운지를 설명하는 데 사용한다)

# **데이터베이스 단위 테스트 시 발생하는 임피던스 불일치**  
데이터베이스 단위 테스트 시 발생하는 임피던스 불일치 문제의 세 가지 원인  
  
# **단위 테스트는 코드를 격리시켜 실행해야 한다.**  
순수주의자의 관점에서 데이터베이스에 접근하는 코드를 포함하는 테스트는 단위 테스트로 간주하기 어렵다. 단위 테스트는 외부와 격리시켜 실행되어야  
데이터베이스와 관련한 단위 테스트는 테스트가 데이터베이스에 의존해야 하기 때문이다.  
  
데이터베이스 테스트는 사용하는 맥락에 따라 다른 범주에 속할 수 있다. 사실 데이터베이스에 접근하는 코드는 통합 테스트와 단위 테스트 모두에 사용할  
수 있다.  
  
- 단위 테스트는 데이터베이스와 직접 상호작용하는 데이터 접근 객체를 테스트하는 데도 사용할 수 있다. DAO(data access object, 데이터 접근 객체)  
는 영속성 계층의 세부 사항을 외부로 노출하지 않은 채 데이터베이스에 대한 인터페이스를 제공하고 애플리케이션 호출을 특정 데이터베이스 작업으로  
연결하는 역할을 한다. 데이터 접근 객체를 테스트한다는 것은 데이터베이스에 대해 적절한 동작을 수행하는 수행하는 것을 보장하기 위해 꼭 필요하며 이런  
테스트는 데이터베이스나 영속성 프레임워크 같은 외부 엔티티에 의존한다. 그럼에도 더 큰 애플리케이션의 구성 요소(building block)이기에 각각의  
단위를 훈련하는 역할도 한다.
- 마찬가지로 데이터베이스에 접근할 필요 없이 퍼사드(facade) 등 상위 계층을 테스트할 수 있는 단위 테스트를 작성할 수 있다. 이런 테스트에서는  
영속성 계층을 모의 객체나 스텁으로 대체할 수 있다. 건축에서 퍼사드가 하는 역할처럼 퍼사드 디자인 패턴은 앞쪽에 간단한 인터페이스를 두고 그 아래에  
복잡한 코드를 숨긴다.  
  
기존 데이터베이스에 들어 있는 데이터가 테스트에 방해를 할 수 있으므로 데이터베이스와 관련한 테스트를 수행하기 전에는 데이터베이스가 알려진 상태임을  
보장하는 것이 중요하다.  
  
# **단위 테스트는 작성과 구동이 쉬워야 한다.**  
단위 테스트를 작성하고 구동하는 작업이 쉽지 않다면 개발자들은 단위 테스트를 작성하지 않을 것이다. 게다가 데이터베이스에 접근하는 코드 작성 작업  
역시 쉬운 일이 아니다. SQL을 작성하고 수많은 try/catch/finally 코드를 작성해야 하며 SQL을 자바로 또는 자바에서 SQL로 변환하는 부담스러운  
작업을 해야 한다.  
  
결국 데이터베이스와 관련한 단위 테스트가 제대로 되려면 개발자들의 데이터베이스 부담을 줄여야 한다.  
  
# **단위 테스트는 실행 속도가 빨라야 한다.**  
일반적으로 데이터베이스 접근 그 자체로 인해 딜레이가 생긴다. 데이터베이스는 다수 이용자의 접근이 가능한 원격 서버이기 때문이다. 이때 데이터베이스를  
조금 더 개발자 쪽으로 옮기면 문제를 해결하는 데 도움이 될 수 있다. 현재 애플리케이션이 데이터베이스 교체가 용이한 표준 SQL이나 ORM 프레임워크를  
사용한다면 내장 데이터베이스나 로컬 PC에 설치 가능한 경량급 데이터베이스를 고려해 볼 수 있다.  
  
# **JDBC 애플리케이션 테스트하기**  
JDBC는 클라이언트가 데이터베이스에 접근하는 방법을 정의한 자바 API다. JDBC는 관계형 데이터베이스의 데이터를 조회하고 변경하는 API를 제공한다.  
JDBC는 자바 초기부터 사용된 API 중 하나이며 데이터베이스 애플리케이션에 사용하도록 설계되었으므로 지금도 여전히 많은 프로젝트에서 사용되고 다른  
기술과 함께가 아닌 단독으로 쓰일 수도 있다.  
  
커넥션, 테이블 관리 클래스  
jdbc 패키지 참조  
  
dao  
jdbc 패키지 -> dao 패키지 참조  
  
데이터베이스에 데이터를 집어 넣고 데이터가 알려진 상태인지 확인하는 클래스  
jdbc 패키지 -> CountriesLoader 클래스 참조  
  
애플리케이션과 데이터베이스 간 상호작용 테스트
jdbc 패키지 -> CountriesDatabeseTest 클래스 참조  
  
온전히 JDBC만 가지고 데이터베이스에 접근했는데 테스트의 반복되는 작업을 위해 아래와 같은 지루한 코드를 작성해야 했다.  
- 커넥션 객체를 생성하고 얻는 작업  
- 쿼리를 만들고 준비하고 실행하는 작업  
- 결과를 반복적으로 순회하는 작업  
- 각 반복에 대해 수행하는 추가 작업  
- 예외를 처리하는 작업  
- 커넥션을 반납하는 작업  
  
